# brain-trainingï¼ˆå¤±æ™ºå‹å–„è…¦åŠ›è¨“ç·´ï¼‰ / Elder-Friendly Brain Training

é€™æ˜¯ä¸€å€‹ä»¥é•·è€…/å¤±æ™ºå‹å–„ç‚ºç›®æ¨™çš„å‰ç«¯ Web Appï¼šæä¾›ã€ŒMini-Cogâ„¢ å¿«é€ŸèªçŸ¥ç¯©æª¢ã€ã€ã€Œå®Œæ•´èƒ½åŠ›è©•ä¼°ã€ã€ä»¥åŠå¤šæ¬¾èªçŸ¥è¨“ç·´éŠæˆ²ï¼Œä¸¦æ”¯æ´æ¯æ—¥è¨“ç·´ï¼ˆæ¯æ—¥æŒ‘æˆ°ï¼‰èˆ‡è¨“ç·´å ±å‘Šã€‚
This is an elder-friendly cognitive training web app that provides Mini-Cogâ„¢ screening, a full assessment, and multiple training games, with daily challenge flows and reports.

## åŠŸèƒ½ç¾æ³ï¼ˆä»¥ç¨‹å¼ç‚ºæº–ï¼‰/ Current Features (source of truth: code)

- è©•ä¼°
  - `Mini-Cogâ„¢`ï¼š3 è©èªè¨˜æ†¶ + æ™‚é˜ç¹ªåœ–ï¼ˆå«æµç¨‹å¼•å°èˆ‡çµæœé ï¼‰
  - å®Œæ•´èƒ½åŠ›è©•ä¼°ï¼šåæ‡‰/è¨˜æ†¶/é‚è¼¯ç­‰é¡Œå‹ï¼Œç”¢å‡ºå»ºè­°é›£åº¦ï¼ˆè¡Œå‹•ç‰ˆé¿å…è£åˆ‡ã€æ¸›å°‘ä¸Šä¸‹æ²å‹•ï¼‰
- éŠæˆ²ï¼ˆç›®å‰è¨»å†Š 15 æ¬¾ï¼‰
  - `whack-a-mole` æ‰“åœ°é¼ 
  - `balance-scale` å¤©å¹³æ¯”é‡
  - `card-match` ç¿»ç‰Œé…å°
  - `stroop-test` Stroopæ¸¬è©¦
  - `maze-navigation` çš‡å®¶èŠ±åœ’è¿·å®®
  - `spot-difference` æ‰¾ä¸åŒ
  - `math-calc` åŠ æ¸›ä¹˜é™¤
  - `instant-memory` ç¬é–“è¨˜æ†¶
  - `poker-memory` æ’²å…‹è¨˜æ†¶
  - `rock-paper-scissors` çŒœæ‹³éŠæˆ²
  - `gesture-memory` æ‰‹å‹¢è¨˜æ†¶
  - `number-connect` æ•¸å­—é€£é€£çœ‹
  - `pattern-reasoning` åœ–å½¢æ¨ç†
  - `audio-memory` è½è¦ºè¨˜æ†¶
  - `rhythm-mimic` ç¯€å¥æ¨¡ä»¿
- æ¯æ—¥è¨“ç·´ï¼ˆæ¯æ—¥æŒ‘æˆ°ï¼‰
  - è‡ªå‹•ç”Ÿæˆç•¶æ—¥è¨“ç·´æ¸…å–®ï¼ˆä¾èªçŸ¥ç¶­åº¦è¦†è“‹èˆ‡å¼±é …å„ªå…ˆï¼‰
  - ä¸­é€”é›¢é–‹å¾Œæœƒå¾è³‡æ–™åº«é‚„åŸç•¶æ—¥é€²åº¦ï¼Œç¹¼çºŒä¸‹ä¸€å€‹æœªå®Œæˆçš„éŠæˆ²ï¼ˆä¸æœƒé‡é ­é–‹å§‹ï¼‰
  - éŠæˆ²çµæŸå¾Œå¯ã€Œç¹¼çºŒä¸‹ä¸€å€‹éŠæˆ²ã€ï¼Œå®Œæˆå¾Œé¡¯ç¤ºå®Œæˆå½ˆçª—èˆ‡å¯å‰å¾€å ±å‘Š
- éŠæˆ²çµæŸæ¨è–¦
  - çµç®—ç•«é¢æœƒæ¨è–¦ã€Œä¸åŒç¶­åº¦ã€çš„ä¸‹ä¸€å€‹éŠæˆ²ï¼ˆè‹¥å€™é¸ä¸è¶³æœƒé€€è€Œæ±‚å…¶æ¬¡æ¨è–¦å…¶ä»–éŠæˆ²ï¼›æ¯æ—¥è¨“ç·´å…¨éƒ¨å®Œæˆæ™‚ä»æœƒæä¾›æ¨è–¦ï¼‰
- æ—¥æœŸèˆ‡çµ±è¨ˆ
  - ä»¥æœ¬åœ°æ™‚å€è¨ˆç®— `YYYY-MM-DD` æ—¥æœŸéµï¼Œé€±æ›†/æ¯æ—¥è¨“ç·´ä¸å— UTC ä½ç§»å½±éŸ¿

- Assessment
  - `Mini-Cogâ„¢`: 3-word recall + clock drawing (guided flow and results)
  - Full assessment: reaction/memory/logic tasks with suggested difficulty (mobile-optimized)
- Games (15 registered)
  - `whack-a-mole`, `balance-scale`, `card-match`, `stroop-test`, `maze-navigation`, `spot-difference`,
    `math-calc`, `instant-memory`, `poker-memory`, `rock-paper-scissors`, `gesture-memory`,
    `number-connect`, `pattern-reasoning`, `audio-memory`, `rhythm-mimic`
- Daily Training (Daily Challenge)
  - Auto-generated daily plan (covers cognitive dimensions and weaker areas first)
  - Resume progress after leaving; continues next unfinished game (no restart)
  - â€œContinue next gameâ€ flow after completion; final dialog links to report
- Post-game Recommendations
  - Summary recommends a game from different dimensions (fallback to others if insufficient candidates)
- Dates & Stats
  - Uses local timezone `YYYY-MM-DD` keys; weekly/daily stats unaffected by UTC shift

## é‡è¦è·¯ç”± / æ“ä½œæµç¨‹ / Key Routes & Flows

- éŠæˆ²çµ±ä¸€å…¥å£ï¼š`/games/:gameId`
  - å…§å«ï¼šçµ±ä¸€çš„éŠæˆ²èªªæ˜ã€é›£åº¦èª¿æ•´ã€é–‹å§‹éŠæˆ²ã€çµç®—ï¼ˆå«æ¨è–¦/ä¸‹ä¸€æ­¥ï¼‰
  - ç›¸å®¹èˆŠé€£çµï¼š`/games/:gameId/preview` æœƒ redirect åˆ° `/games/:gameId`
- ç™»å…¥ï¼š`/login`
- æ–°æ‰‹å¼•å°ï¼š`/onboarding`
- æ¯æ—¥æŒ‘æˆ°ï¼š`/daily-challenge`
- èƒ½åŠ›è©•ä¼°ï¼š`/assessment`
- å ±å‘Šï¼š`/report`ã€`/weekly-report`
- ç‡Ÿé¤Šå»ºè­°ï¼š`/nutrition`
- è¨­å®šï¼š`/settings`

- Unified game entry: `/games/:gameId`
  - Includes instructions, difficulty selection, start, results (with next-game recommendations)
  - Legacy link `/games/:gameId/preview` redirects to `/games/:gameId`
- Login: `/login`
- Onboarding: `/onboarding`
- Daily Challenge: `/daily-challenge`
- Assessment: `/assessment`
- Reports: `/report`, `/weekly-report`
- Nutrition: `/nutrition`
- Settings: `/settings`

å¸¸ç”¨ queryï¼ˆç”±ç¨‹å¼å…§éƒ¨ä½¿ç”¨ï¼‰ï¼š
- `fromDaily=true`ï¼šè¡¨ç¤ºå¾æ¯æ—¥è¨“ç·´é€²å…¥
- `autoStart=true`ï¼šç”¨æ–¼ã€Œæ¨è–¦ä¸‹ä¸€å€‹ã€ç›´æ¥å•Ÿå‹•éŠæˆ²
- `subDifficulty=1|2|3`ï¼šå­é›£åº¦ï¼ˆç´°åˆ†ï¼‰

Common query params (internal use):
- `fromDaily=true`: entered from daily training
- `autoStart=true`: auto-start the recommended next game
- `subDifficulty=1|2|3`: sub-difficulty

## é–‹ç™¼ / Development

éœ€æ±‚ï¼šNode.jsï¼ˆå»ºè­°ä½¿ç”¨å°ˆæ¡ˆæ—¢æœ‰çš„ `package-lock.json` å°é½Šç‰ˆæœ¬ï¼‰
Requirement: Node.js (align with the version implied by `package-lock.json`).

```bash
npm install
npm run dev
```

å»ºç½® / æ¸¬è©¦ï¼š
Build / Test:

```bash
npm run build
npm run test:run
```

Storybookï¼š
Storybook:

```bash
npm run storybook
```

E2E / è¦–è¦ºå›æ­¸ï¼š
E2E / Visual Regression:

```bash
npm run test:e2e
npm run test:e2e:update
```

## æ–‡æª” / Documentation

æ–‡ä»¶ç´¢å¼•èˆ‡æ•´ç†ï¼š`docs/README.md`
Docs index: `docs/README.md`

## ä¾è³´å®‰å…¨èˆ‡å®‰è£æé†’ / Dependency & Install Notes

- å·²å‡ç´š `html2pdf.js` èˆ‡ `vitest` ç³»åˆ—ç›¸ä¾ä»¥æ¶ˆé™¤ `npm audit` ä¸­çš„å·²çŸ¥æ¼æ´ã€‚
- è‹¥ `npm install` åœ¨ Windows å‡ºç¾ `EPERM`ï¼ˆé€šå¸¸æ˜¯ `.vitest-*` æš«å­˜è³‡æ–™å¤¾è¢«å ç”¨ï¼‰ï¼Œè«‹å…ˆé—œé–‰åŸ·è¡Œä¸­çš„ Node/Vite/Vitest ç¨‹åºï¼Œå†åˆªé™¤ `node_modules/.vitest-*` å¾Œé‡è©¦å®‰è£ã€‚
- `npm install` çš„ deprecated è­¦å‘Šå¤šç‚ºç›¸ä¾æ¨¹å…§éƒ¨å¥—ä»¶ï¼ŒçŸ­æœŸä¸å½±éŸ¿åŸ·è¡Œï¼Œå¯å¾…ä¸Šæ¸¸æ›´æ–°ã€‚

- `html2pdf.js` and `vitest` dependencies were upgraded to address `npm audit` findings.
- On Windows, if `npm install` fails with `EPERM` (usually `.vitest-*` cache in use), close running Node/Vite/Vitest processes, delete `node_modules/.vitest-*`, and retry.
- Most deprecated warnings are transitive; they do not block execution and can wait for upstream updates.

## è³‡æ–™å„²å­˜èˆ‡åŒæ­¥ / Data Storage & Sync

- æœ¬åœ°ç«¯ï¼šä½¿ç”¨ IndexedDBï¼ˆè¦‹ `src/services/db.ts`ï¼‰ä¿å­˜ä½¿ç”¨è€…ã€éŠæˆ²ç´€éŒ„ã€æ¯æ—¥è¨“ç·´æœƒè©±ã€è©•ä¼°çµæœç­‰ã€‚
- é¸é…ï¼šå¯åŒæ­¥åˆ° Google Sheetï¼ˆè¦‹ `src/services/googleSheetSyncService.ts`ï¼›Apps Script Web App éœ€è‡ªè¡Œå»ºç«‹ï¼Œè©³è¦‹ `docs/data-schema.md`ï¼‰ã€‚
- åŒæ­¥å‰æï¼šéœ€ä½¿ç”¨è€…åŒæ„è³‡æ–™åˆ†æï¼ˆ`analyticsConsent=true`ï¼‰ï¼ŒæœªåŒæ„ä¸æœƒä¸Šå‚³ã€‚
- åŒæ­¥è³‡æ–™æœƒæ”œå¸¶ `schemaVersion`ã€`scoringVersion` èˆ‡è³‡æ–™å“è³ªæ¬„ä½ï¼ˆ`dataQuality`ã€`dataIssues`ï¼‰ã€‚

- Local: IndexedDB (`src/services/db.ts`) stores users, game sessions, daily training, and assessment results.
- Optional: sync to Google Sheets (`src/services/googleSheetSyncService.ts`); create your own Apps Script Web App (see `docs/data-schema.md`).
- Sync requires analytics consent (`analyticsConsent=true`).
- Sync payload includes `schemaVersion`, `scoringVersion`, and data quality fields (`dataQuality`, `dataIssues`).

## è³‡æ–™åŒæ„ï¼ˆConsentï¼‰/ Consent

- åŒæ„é …ç›®å®šç¾©èˆ‡ç‰ˆæœ¬ï¼š`src/types/user.ts`ï¼ˆ`CONSENT_DESCRIPTIONS`ã€`CURRENT_CONSENT_VERSION`ï¼‰ã€‚
- è¡Œç‚ºè¿½è¹¤èˆ‡é†«ç™‚å ±å‘Šå±¬å¯é¸åŒæ„ï¼ŒæœªåŒæ„ä¸å½±éŸ¿æ ¸å¿ƒéŠæˆ²åŠŸèƒ½ã€‚

- Consent definitions and version: `src/types/user.ts` (`CONSENT_DESCRIPTIONS`, `CURRENT_CONSENT_VERSION`).
- Behavior tracking and medical report sharing are optional and do not block core gameplay.

## å¤–éƒ¨ç™»å…¥ / App å…§åµŒ / External Auth & App Embedding

- æ”¯æ´ App/WebView é€é `postMessage` æˆ– `window.BrainTrainingBridge.setExternalProfile(...)` å‚³å…¥ä½¿ç”¨è€…è³‡æ–™ã€‚
- è©³ç´°æ ¼å¼èˆ‡ç¯„ä¾‹ï¼š`docs/app-embedding.md`ã€‚

- App/WebView can pass profiles via `postMessage` or `window.BrainTrainingBridge.setExternalProfile(...)`.
- Details and examples: `docs/app-embedding.md`.

## è©•åˆ†æ¨™æº– / Scoring

- åƒè€ƒ `docs/SCORING.md`ï¼ˆæ¨™æº–åŒ–è¨ˆåˆ†ã€æ¬Šé‡èˆ‡é›£åº¦å€ç‡ï¼‰ã€‚

- See `docs/SCORING.md` (normalization, weights, difficulty multipliers).

## ä¸»é¡Œèˆ‡æ¨£å¼ / Theme & Styles

- å…¨ç«™ä½¿ç”¨ CSS è®Šæ•¸èˆ‡èªç¾©è‰²ç¥¨ï¼ˆè¦‹ `src/style.css`ï¼‰ã€‚
- ä¸»é¡Œç‚ºè—/ç¶ æ­é…æš–è‰²é»ç¶´ï¼Œæ”¯æ´æ·±è‰²æ¨¡å¼ã€‚

- Uses CSS variables and semantic color tokens (`src/style.css`).
- Theme: blue/green with warm accents; dark mode supported.

## è³‡ç”¢ï¼ˆAssetsï¼‰èˆ‡åœ–ç¤º / Assets & Icons

- éœæ…‹è³‡ç”¢æ¸…å–®ï¼š`public/assets_manifest.json`ï¼ˆè«‹åœ¨æœ‰ `base` çš„éƒ¨ç½²è·¯å¾‘ä¸‹å­˜å–ï¼Œå¦‚ `/brain-training/assets_manifest.json`ï¼‰ã€‚
- `assetLoader` æœƒä¾ `assets_manifest.json` å–å¾—åœ–ç¤ºï¼›è³‡æºç¼ºå¤±æ™‚ä½¿ç”¨ emoji fallbackã€‚
- å®Œæ•´è³‡ç”¢åˆ—è¡¨ï¼š`docs/ASSET_FULL_LIST.md`ã€‚

- Asset manifest: `public/assets_manifest.json` (with `base`, e.g. `/brain-training/assets_manifest.json`).
- `assetLoader` resolves icons from the manifest; missing assets fallback to emoji.
- Full asset list: `docs/ASSET_FULL_LIST.md`.

## FAQï¼šbase URL å°è³‡ç”¢è¼‰å…¥çš„å½±éŸ¿ / FAQ: base URL and assets

**Q: ç‚ºä»€éº¼ icon è®Šæˆ ğŸ¯ æˆ–æ²’æœ‰æ­£ç¢ºè¼‰å…¥ï¼Ÿ**

A: è‹¥å°ˆæ¡ˆè¨­å®šäº† `base`ï¼ˆä¾‹å¦‚ `/brain-training/`ï¼‰ï¼Œ`assets_manifest.json` æœƒåœ¨ `/brain-training/assets_manifest.json`ã€‚
è«‹ç¢ºèªè©²è·¯å¾‘å¯æ­£å¸¸å­˜å–ï¼›è‹¥ manifest è®€å–å¤±æ•—æˆ–ç”¨é€”æœªåŒ¹é…ï¼Œåœ–ç¤ºæœƒå›é€€åˆ° emojiã€‚

A: If `base` is set (e.g. `/brain-training/`), `assets_manifest.json` is at `/brain-training/assets_manifest.json`.
Make sure the path is reachable; if manifest loading fails or usage doesn't match, icons fallback to emoji.

## å°ˆæ¡ˆçµæ§‹ï¼ˆç°¡ç•¥ï¼‰/ Project Structure (Brief)

- `src/views/`ï¼šä¸»è¦é é¢ï¼ˆè©•ä¼°ã€æ¯æ—¥æŒ‘æˆ°ã€éŠæˆ²ã€å ±å‘Šâ€¦ï¼‰
- `src/components/games/`ï¼šå„éŠæˆ²èˆ‡å…±ç”¨ UI å…ƒä»¶
- `src/games/logic/`ï¼šéŠæˆ²é‚è¼¯ï¼ˆç´”å‡½æ•¸/å¯æ¸¬è©¦ï¼‰
- `src/stores/`ï¼šPinia ç‹€æ…‹ï¼ˆä½¿ç”¨è€…ã€éŠæˆ²ã€è¨­å®šï¼‰
- `src/services/`ï¼šDBã€æ¯æ—¥è¨“ç·´ã€é›£åº¦è‡ªé©æ‡‰ã€åˆ†æ•¸æ­£è¦åŒ–ç­‰æœå‹™

- `src/views/`: route-level views (assessment, daily challenge, games, reports...)
- `src/components/games/`: game UIs and shared game components
- `src/games/logic/`: pure game logic (testable)
- `src/stores/`: Pinia state (user, game, settings)
- `src/services/`: DB, daily training, adaptive difficulty, score normalization, etc.
